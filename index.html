<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asset Booking System</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
body{font-family:'Roboto',sans-serif;margin:0;padding:0;color:#f0f0f0;background:linear-gradient(-45deg,#1f1f1f,#2c2c2c,#3a3a3a,#2c2c2c);background-size:400% 400%;animation:gradientBG 20s ease infinite}
@keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
h1{text-align:center;margin-top:20px;color:#ffd700;text-shadow:1px 1px 4px #000;font-size:2rem;position:relative}
#loginBtn{position:absolute;top:20px;right:20px;padding:10px 20px;border-radius:15px;border:none;cursor:pointer;background:linear-gradient(45deg,#ffd700,#ffb700);font-weight:600;color:#1f1f1f;font-size:1rem;transition:all 0.3s ease}
#loginBtn:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(255,215,0,0.8)}
#inboxBtn{position:absolute;top:60px;right:20px;padding:8px 18px;border-radius:15px;border:none;cursor:pointer;background:linear-gradient(45deg,#ff8c00,#ffb700);font-weight:600;color:#1f1f1f;font-size:0.9rem;display:none}
#inboxBtn:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(255,140,0,0.8)}
#adminPageBtn{position:absolute;top:100px;right:20px;padding:8px 18px;border-radius:15px;border:none;cursor:pointer;background:linear-gradient(45deg,#00bfff,#1e90ff);font-weight:600;color:#1f1f1f;font-size:0.9rem;display:none}
#adminPageBtn:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(0,191,255,0.8)}
.container{width:90%;max-width:600px;margin:30px auto;background:rgba(44,44,44,0.95);padding:25px 30px;border-radius:20px;box-shadow:0px 15px 40px rgba(0,0,0,0.7);backdrop-filter:blur(5px);transition:all 0.3s ease}
.section h2{color:#ffd700;border-bottom:2px solid #ffd700;padding-bottom:5px;margin-bottom:15px;font-size:1.3rem}
form{display:flex;flex-direction:column;gap:12px}
label{font-weight:500;color:#e0e0e0}
input,select,textarea{padding:10px;font-size:16px;border-radius:10px;border:none;outline:none;background:#3a3a3a;color:#f0f0f0;transition:all 0.3s ease}
input:focus,select:focus,textarea:focus{border:1px solid #ffd700;box-shadow:0 0 15px rgba(255,215,0,0.5)}
button{cursor:pointer;background:linear-gradient(45deg,#ffd700,#ffb700);color:#1f1f1f;font-weight:600;padding:14px;border-radius:15px;font-size:1rem;transition:all 0.3s ease}
button:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(255,215,0,0.8)}
.section{margin-bottom:35px}
.booking-list table{width:100%;border-collapse:collapse;background:rgba(44,44,44,0.9);color:#f0f0f0;overflow-x:auto;display:block}
th,td{padding:12px;border:1px solid #444;text-align:center;min-width:80px}
th{background:#3a3a3a;color:#ffd700}
tr:nth-child(even){background:#343434}
tr:hover{background:#444444;transition:0.3s}
textarea:disabled{background:#2c2c2c;color:#888}
.home-buttons{display:flex;flex-direction:column;gap:20px;align-items:center;justify-content:center;margin-top:40px}
.modal{display:none;position:fixed;z-index:100;left:0;top:0;width:100%;height:100%;overflow:auto;background:rgba(0,0,0,0.7);justify-content:center;align-items:center}
.modal-content{background:#2c2c2c;padding:30px;border-radius:20px;width:90%;max-width:400px;box-shadow:0px 10px 30px rgba(0,0,0,0.8)}
.modal-content h2{color:#ffd700;margin-bottom:20px;text-align:center}
#adminInboxModal .modal-content,#adminHistoryModal .modal-content{max-height:80vh;overflow-y:auto}
#accessoryOptions label{display:block;margin-bottom:5px}
@media(max-width:768px){.container{padding:20px}h1{font-size:1.8rem}.section h2{font-size:1.2rem}input,select,textarea,button{font-size:15px}}
@media(max-width:480px){h1{font-size:1.5rem}.section h2{font-size:1rem}input,select,textarea,button{font-size:14px;padding:8px}th,td{padding:8px;min-width:70px}#loginBtn{padding:8px 16px;font-size:0.9rem}}
</style>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";
import { getFirestore, collection, doc, setDoc, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyCvTG5I4FXYJ1JAeTintjziCAc7mEFOykw",
    authDomain: "bookingsystempis.firebaseapp.com",
    projectId: "bookingsystempis",
    storageBucket: "bookingsystempis.firebasestorage.app",
    messagingSenderId: "42607164051",
    appId: "1:42607164051:web:ab389bb7406e6ade77eb66",
    measurementId: "G-ZEB6PQEWP3"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);

// Utility: Firebase Firestore Collections
const bookingsCol = collection(db, "bookings");
const historyCol = collection(db, "history");
const inboxCol = collection(db, "inboxAdmin");
</script>

</head>
<body>

<h1>Asset Booking System
<button id="loginBtn" onclick="openLoginModal()">Login Admin</button>
<button id="inboxBtn" onclick="openInboxModal()">Admin Inbox</button>
<button id="adminPageBtn" onclick="showPage('adminPage')">Admin Panel</button>
</h1>

<!-- Modals & Pages sama seperti code asal -->

<!-- Login Modal -->
<div id="loginModal" class="modal">
<div class="modal-content">
<h2>Login Admin</h2>
<input type="text" id="adminUsername" placeholder="Username">
<input type="password" id="adminPassword" placeholder="Password">
<button onclick="adminLogin()">Login</button>
<button onclick="closeLoginModal()">Cancel</button>
</div>
</div>

<!-- Admin Inbox Modal -->
<div id="adminInboxModal" class="modal">
<div class="modal-content">
<h2>Inbox Admin - Barang Tidak Lengkap</h2>
<div id="inboxContent"></div>
<button onclick="closeInboxModal()">Close</button>
</div>
</div>

<!-- Admin History Modal -->
<div id="adminHistoryModal" class="modal">
<div class="modal-content">
<h2>Jadual Pemulangan (60 Hari)</h2>
<div id="historyContent"></div>
<button onclick="closeHistoryModal()">Close</button>
</div>
</div>

<!-- Home Page -->
<div class="container" id="homePage">
<div class="home-buttons">
<button onclick="showPage('bookingPage')">Menu Peminjaman</button>
<button onclick="showPage('returnPage')">Menu Pemulangan</button>
</div>
</div>

<!-- Booking Page -->
<div class="container" id="bookingPage" style="display:none;">
<div class="section">
<h2>Form Peminjaman</h2>
<form id="bookingForm">
<label>Nama:</label>
<input type="text" id="name" required>
<label>Tarikh Peminjaman:</label>
<input type="date" id="date" required>
<label>Tujuan:</label>
<textarea id="purpose" rows="2" required></textarea>
<label>Laptop:</label>
<select id="laptop" required>
<option value="NONE">NONE</option>
<option value="0301">0301</option>
<option value="0302">0302</option>
<option value="0303">0303</option>
</select>
<label>LCD:</label>
<select id="lcd" required>
<option value="NONE">NONE</option>
<option value="JPA1">JPA1</option>
<option value="JPA2">JPA2</option>
<option value="JPA3">JPA3</option>
</select>
<label>Aksesori:</label>
<div id="accessoryOptions">
<label><input type="checkbox" value="HDMI"> HDMI</label>
<label><input type="checkbox" value="MOUSE"> MOUSE</label>
<label><input type="checkbox" value="CHARGER LAPTOP"> CHARGER LAPTOP</label>
<label><input type="checkbox" value="POWER PLUG LCD"> POWER PLUG LCD</label>
<label><input type="checkbox" value="NONE"> NONE</label>
</div>
<button type="submit">Submit Peminjaman</button>
<button type="button" onclick="showPage('homePage')">Kembali ke Home</button>
</form>
</div>
<div class="section booking-list">
<h2>Senarai Peminjaman Aktif</h2>
<table id="bookingTable1">
<thead><tr><th>Reference</th><th>Nama</th><th>Tarikh</th><th>Tujuan</th><th>Laptop</th><th>LCD</th><th>Aksesori</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>

<!-- Return Page & Admin Page sama seperti asal, tak diubah -->

<script type="module">
// DATA
let bookings=[]; // aktif
let inboxAdmin=[]; // incomplete
let history=[]; // pemulangan history
let adminLoggedIn=false;
let accessOpen=true;
let accessoryStock = { 'HDMI':3,'MOUSE':3,'CHARGER LAPTOP':3,'POWER PLUG LCD':3 };

// Firebase references (from head)
import { db } from './'; // already defined in head
import { collection, doc, setDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// --- UTILITY FUNCTIONS ---
function generateRef(){return 'REF'+Date.now()+'-'+Math.floor(Math.random()*10000);}
function openLoginModal(){document.getElementById('loginModal').style.display='flex'}
function closeLoginModal(){document.getElementById('loginModal').style.display='none'}
function openInboxModal(){
    const c=document.getElementById('inboxContent');
    c.innerHTML=inboxAdmin.length===0?'<p>Tidak ada laporan.</p>':inboxAdmin.map(i=>`<p><b>${i.ref}</b> - ${i.name} (${i.date}) : ${i.notes}</p>`).join('');
    document.getElementById('adminInboxModal').style.display='flex';
}
function closeInboxModal(){document.getElementById('adminInboxModal').style.display='none'}
function closeHistoryModal(){document.getElementById('adminHistoryModal').style.display='none'}
function adminLogin(){
    const u=document.getElementById('adminUsername').value.trim();
    const p=document.getElementById('adminPassword').value.trim();
    if(u==='Admin JPA'&&p==='adminjpapis01'){
        adminLoggedIn=true;
        closeLoginModal();
        document.getElementById('loginBtn').style.display='none';
        document.getElementById('inboxBtn').style.display='block';
        document.getElementById('adminPageBtn').style.display='block';
        alert('Login Berjaya!');
    } else { alert('Username atau Password salah!') }
}
function toggleAccess(){accessOpen=!accessOpen;document.getElementById('accessStatus').innerText="Akses Sekarang: "+(accessOpen?"Dibuka":"Ditutup")}
function showPage(id){['homePage','bookingPage','returnPage','adminPage'].forEach(p=>document.getElementById(p).style.display='none');updateTable();document.getElementById(id).style.display='block'}

// --- FIRESTORE SYNC FUNCTIONS ---
async function saveBookingsToFirebase(){
    for(const b of bookings){
        await setDoc(doc(db,'bookings',b.ref), b);
    }
}
async function saveHistoryToFirebase(){
    for(const h of history){
        await setDoc(doc(db,'history',h.ref), h);
    }
}
async function saveInboxToFirebase(){
    for(const i of inboxAdmin){
        await setDoc(doc(db,'inboxAdmin',i.ref), i);
    }
}
async function loadAllData(){
    // Load bookings
    const snapshotBookings = await getDocs(collection(db,'bookings'));
    bookings = snapshotBookings.docs.map(d=>d.data());

    // Load history
    const snapshotHistory = await getDocs(collection(db,'history'));
    history = snapshotHistory.docs.map(d=>d.data());

    // Load inbox
    const snapshotInbox = await getDocs(collection(db,'inboxAdmin'));
    inboxAdmin = snapshotInbox.docs.map(d=>d.data());

    updateTable();
}

// --- UPDATE TABLE & DROPDOWNS ---
function updateTable(){
    ['bookingTable1','bookingTable2'].forEach(tid=>{
        const tb=document.getElementById(tid).querySelector('tbody');tb.innerHTML='';
        bookings.forEach(b=>{
            const tr=document.createElement('tr');
            tr.innerHTML=`<td>${b.ref}</td><td>${b.name}</td><td>${b.date}</td><td>${b.purpose}</td><td>${b.laptop}</td><td>${b.lcd}</td><td>${b.accessory.join(', ')}</td>`;
            tb.appendChild(tr);
        });
    });
}

// --- Booking Form Submit ---
const accessoryCheckboxes = document.querySelectorAll('#accessoryOptions input[type="checkbox"]');
document.getElementById('bookingForm').addEventListener('submit', async function(e){
    e.preventDefault();
    if(!accessOpen){ alert('Akses Peminjaman ditutup!'); return; }
    const name = document.getElementById('name').value.trim();
    const date = document.getElementById('date').value;
    const purpose = document.getElementById('purpose').value.trim();
    const laptop = document.getElementById('laptop').value;
    const lcd = document.getElementById('lcd').value;
    let accessory = Array.from(accessoryCheckboxes).filter(c=>c.checked).map(c=>c.value);
    const ref = generateRef();
    const bookingObj = {ref,name,date,purpose,laptop,lcd,accessory};
    bookings.push(bookingObj);
    await saveBookingsToFirebase();
    alert('Peminjaman berjaya! Reference Code: '+ref);
    this.reset();
    accessoryCheckboxes.forEach(c=>c.disabled=false);
    updateTable();
});

// --- Load all data on page load ---
window.onload = loadAllData;
</script>

</body>
</html>
